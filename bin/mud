#!/usr/bin/env php
<?php
declare(strict_types=1);

require_once __DIR__.'/../bootstrap.php';

use PhpMud\Entity\Area;
use PhpMud\Entity\Room;
use PhpMud\Entity\Item;
use PhpMud\Entity\Mob;
use PhpMud\Enum\Material;
use PhpMud\Race\Human;
use PhpMud\Server;

$roomRepository = $em->getRepository(Room::class);
$room = $roomRepository->find(1);

if (!$room) {
    echo "creating initial world fixtures\n";
    $area = new Area('Midgaard');
    $room = new Room();
    $room->setTitle('Midgaard Town Center');
    $room->setDescription('Before you is the town center.');
    $room->getInventory()->add(new Item('a copper teapot', Material::COPPER(), ['copper', 'teapot']));
    $item = new Item('a wooden sword', Material::WOOD(), ['wooden', 'sword']);
    $item->setPosition(\PhpMud\Enum\Position::WIELDED());
    $room->getInventory()->add($item);
    $item = new Item('a wooden mace', Material::WOOD(), ['wooden', 'mace']);
    $item->setPosition(\PhpMud\Enum\Position::WIELDED());
    $room->getInventory()->add($item);
    $mob = new Mob('a janitor', new Human());
    $mob->setRoom($room);
    $area->addRoom($room);
    $shopkeeper = new \PhpMud\Entity\Shopkeeper('Bill', new \PhpMud\Race\Dwarf());
    $shopkeeper->setLook('totters around, stinking up the place.');
    $shopkeeper->getShopInventory()->add(new Item('a small brass key', Material::BRASS(), ['small', 'brass', 'key']));
    $room->getMobs()->add($shopkeeper);
}

(new Server($em, $room))->listen($config['ip'], $config['port']);